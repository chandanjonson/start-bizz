{"version":3,"file":"transforms.js","sourceRoot":"","sources":["../../src/transforms.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { PagedAsyncIterableIterator, PageSettings } from \"@azure/core-paging\";\nimport type {\n  ContainerItem,\n  CpkInfo as BlobCpkInfo,\n  PublicAccessType as ContainerPublicAccessType,\n} from \"@azure/storage-blob\";\nimport type { AclFailedEntry, CpkInfo } from \"./generated/src/models/index.js\";\nimport type {\n  AccessControlChangeError,\n  FileSystemItem,\n  Metadata,\n  PathAccessControlItem,\n  PathPermissions,\n  PublicAccessType,\n  RemovePathAccessControlItem,\n  RolePermissions,\n  ServiceListContainersSegmentResponse,\n  ServiceListFileSystemsSegmentResponse,\n} from \"./models.js\";\nimport { ToBlobEndpointHostMappings, ToDfsEndpointHostMappings } from \"./utils/constants.js\";\nimport { base64encode } from \"./utils/utils.common.js\";\n\n/**\n * Get a blob endpoint URL from incoming blob or dfs endpoint URLs.\n * Only handle known host name pair patterns, add more patterns into ToBlobEndpointHostMappings in constants.ts.\n *\n * Expected input and outputs:\n * http://account.blob.core.windows.net     - http://account.blob.core.windows.net\n * http://account.dfs.core.windows.net      - http://account.blob.core.windows.net\n * http://127.0.0.1:10000                   - http://127.0.0.1:10000\n * http://account.blob.core.windows.net/abc - http://account.blob.core.windows.net/abc\n * http://account.dfs.core.windows.net/abc  - http://account.blob.core.windows.net/abc\n * http://127.0.0.1:10000/abc               - http://127.0.0.1:10000/abc\n *\n * @param url -\n */\nexport function toBlobEndpointUrl(url: string): string {\n  return mapHostUrl(url, ToBlobEndpointHostMappings, \"toBlobEndpointUrl\");\n}\n\n/**\n * Get a dfs endpoint URL from incoming blob or dfs endpoint URLs.\n * Only handle known host name pair patterns, add more patterns into ToDfsEndpointHostMappings in constants.ts.\n *\n * Expected input and outputs:\n * http://account.blob.core.windows.net     - http://account.dfs.core.windows.net\n * http://account.dfs.core.windows.net      - http://account.dfs.core.windows.net\n * http://127.0.0.1:10000                   - http://127.0.0.1:10000\n * http://account.blob.core.windows.net/abc - http://account.dfs.core.windows.net/abc\n * http://account.dfs.core.windows.net/abc  - http://account.dfs.core.windows.net/abc\n * http://127.0.0.1:10000/abc               - http://127.0.0.1:10000/abc\n *\n * @param url -\n */\nexport function toDfsEndpointUrl(url: string): string {\n  return mapHostUrl(url, ToDfsEndpointHostMappings, \"toDfsEndpointUrl\");\n}\n\nfunction mapHostUrl(url: string, hostMappings: string[][], callerMethodName: string): string {\n  let urlParsed: URL;\n  try {\n    urlParsed = new URL(url);\n  } catch (e) {\n    // invalid urls are returned unmodified\n    return url;\n  }\n\n  let host = urlParsed.hostname;\n  if (host === undefined) {\n    throw RangeError(`${callerMethodName}() parameter url ${url} doesn't include valid host.`);\n  }\n\n  for (const mapping of hostMappings) {\n    if (host.includes(mapping[0])) {\n      host = host.replace(mapping[0], mapping[1]);\n      break;\n    }\n  }\n  urlParsed.hostname = host;\n  const result = urlParsed.toString();\n  // don't add a trailing slash if one wasn't already present\n  if (!url.endsWith(\"/\") && result.endsWith(\"/\")) {\n    return result.slice(0, -1);\n  } else {\n    return result;\n  }\n}\n\nfunction toFileSystemAsyncIterableIterator(\n  iter: AsyncIterableIterator<ServiceListContainersSegmentResponse>,\n): AsyncIterableIterator<ServiceListFileSystemsSegmentResponse> {\n  return {\n    async next() {\n      const rawResult = await iter.next();\n      if (rawResult.value) {\n        rawResult.value.fileSystemItems = rawResult.value.containerItems.map(\n          (val: ContainerItem): FileSystemItem => {\n            return {\n              ...val,\n              versionId: val.version,\n              properties: {\n                ...val.properties,\n                publicAccess: toPublicAccessType(val.properties.publicAccess),\n              },\n            };\n          },\n        );\n      }\n      return rawResult as any;\n    },\n    [Symbol.asyncIterator]() {\n      return this;\n    },\n  };\n}\n\nexport function toFileSystemPagedAsyncIterableIterator(\n  iter: PagedAsyncIterableIterator<ContainerItem, ServiceListContainersSegmentResponse>,\n): PagedAsyncIterableIterator<FileSystemItem, ServiceListFileSystemsSegmentResponse> {\n  return {\n    async next(): Promise<IteratorResult<FileSystemItem>> {\n      const rawResult = await iter.next();\n      const result = rawResult as IteratorResult<FileSystemItem>;\n      if (!result.done && !rawResult.done) {\n        result.value.properties.publicAccess = toPublicAccessType(\n          rawResult.value.properties.publicAccess,\n        );\n        result.value.versionId = rawResult.value.version;\n      }\n      return result;\n    },\n    [Symbol.asyncIterator](): PagedAsyncIterableIterator<\n      FileSystemItem,\n      ServiceListFileSystemsSegmentResponse\n    > {\n      return this;\n    },\n    byPage(\n      settings: PageSettings = {},\n    ): AsyncIterableIterator<ServiceListFileSystemsSegmentResponse> {\n      return toFileSystemAsyncIterableIterator(iter.byPage(settings));\n    },\n  };\n}\n\nexport function toContainerPublicAccessType(\n  publicAccessType?: PublicAccessType,\n): ContainerPublicAccessType | undefined {\n  if (!publicAccessType) {\n    return undefined;\n  }\n\n  switch (publicAccessType) {\n    case \"filesystem\":\n      return \"container\";\n    case \"file\":\n      return \"blob\";\n    default:\n      throw TypeError(\n        `toContainerPublicAccessType() parameter ${publicAccessType} is not recognized.`,\n      );\n  }\n}\n\nexport function toPublicAccessType(\n  containerPublicAccessType?: ContainerPublicAccessType,\n): PublicAccessType | undefined {\n  if (!containerPublicAccessType) {\n    return undefined;\n  }\n\n  switch (containerPublicAccessType) {\n    case \"container\":\n      return \"filesystem\";\n    case \"blob\":\n      return \"file\";\n    default:\n      throw TypeError(\n        `toPublicAccessType() parameter ${containerPublicAccessType} is not recognized.`,\n      );\n  }\n}\n\nexport function toProperties(metadata?: Metadata): string | undefined {\n  if (metadata === undefined) {\n    return undefined;\n  }\n\n  const properties = [];\n  for (const key in metadata) {\n    if (Object.prototype.hasOwnProperty.call(metadata, key)) {\n      const value = metadata[key];\n      properties.push(`${key}=${base64encode(value)}`);\n    }\n  }\n\n  return properties.join(\",\");\n}\n\nexport function toRolePermissions(permissionsString: string): RolePermissions {\n  const error = new RangeError(\n    `toRolePermissions() Invalid role permissions string ${permissionsString}`,\n  );\n  if (permissionsString.length !== 3) {\n    throw error;\n  }\n\n  permissionsString = permissionsString.toLowerCase();\n\n  let read = false;\n  if (permissionsString[0] === \"r\") {\n    read = true;\n  } else if (permissionsString[0] !== \"-\") {\n    throw error;\n  }\n\n  let write = false;\n  if (permissionsString[1] === \"w\") {\n    write = true;\n  } else if (permissionsString[1] !== \"-\") {\n    throw error;\n  }\n\n  let execute = false;\n  if (permissionsString[2] === \"x\") {\n    execute = true;\n  } else if (permissionsString[2] !== \"-\") {\n    throw error;\n  }\n\n  return { read, write, execute };\n}\n\nexport function toPermissions(permissionsString?: string): PathPermissions | undefined {\n  if (permissionsString === undefined || permissionsString === \"\" || permissionsString === null) {\n    return undefined;\n  }\n\n  if (permissionsString.length !== 9 && permissionsString.length !== 10) {\n    throw RangeError(`toPermissions() Invalid permissions string ${permissionsString}`);\n  }\n\n  let stickyBit = false;\n  if (permissionsString[8] === \"t\") {\n    stickyBit = true;\n    const firstPart = permissionsString.substr(0, 8);\n    const lastPart = permissionsString.substr(9);\n    permissionsString = firstPart + \"x\" + lastPart;\n  } else if (permissionsString[8] === \"T\") {\n    stickyBit = true;\n    const firstPart = permissionsString.substr(0, 8);\n    const lastPart = permissionsString.substr(9);\n    permissionsString = firstPart + \"-\" + lastPart;\n  }\n\n  // Case insensitive\n  permissionsString = permissionsString.toLowerCase();\n\n  let extendedAcls = false;\n  if (permissionsString.length === 10) {\n    if (permissionsString[9] === \"+\") {\n      extendedAcls = true;\n    } else {\n      throw RangeError(\n        `toPermissions() Invalid extendedAcls bit ${permissionsString[9]} in permissions string ${permissionsString}`,\n      );\n    }\n  }\n\n  const owner = toRolePermissions(permissionsString.substr(0, 3));\n  const group = toRolePermissions(permissionsString.substr(3, 3));\n  const other = toRolePermissions(permissionsString.substr(6, 3));\n\n  return {\n    owner,\n    group,\n    other,\n    stickyBit,\n    extendedAcls,\n  };\n}\n\nexport function toAccessControlItem(aclItemString: string): PathAccessControlItem {\n  const error = new RangeError(\n    `toAccessControlItem() Parameter access control item string ${aclItemString} is not valid.`,\n  );\n  if (aclItemString === \"\") {\n    throw error;\n  }\n\n  aclItemString = aclItemString.toLowerCase();\n\n  const parts = aclItemString.split(\":\");\n  if (parts.length < 3 || parts.length > 4) {\n    throw error;\n  }\n\n  let defaultScope = false;\n  let index = 0;\n  if (parts.length === 4) {\n    if (parts[index] !== \"default\") {\n      throw error;\n    }\n    defaultScope = true;\n    index++;\n  }\n\n  const accessControlType = parts[index++];\n  if (\n    accessControlType !== \"user\" &&\n    accessControlType !== \"group\" &&\n    accessControlType !== \"mask\" &&\n    accessControlType !== \"other\"\n  ) {\n    throw error;\n  }\n\n  const entityId = parts[index++];\n  const permissions = toRolePermissions(parts[index++]);\n\n  return {\n    defaultScope,\n    accessControlType,\n    entityId,\n    permissions,\n  };\n}\n\nexport function toRemoveAccessControlItem(aclItemString: string): RemovePathAccessControlItem {\n  const error = new RangeError(\n    `toAccessControlItem() Parameter access control item string \"${aclItemString}\" is not valid.`,\n  );\n  if (aclItemString === \"\") {\n    throw error;\n  }\n\n  aclItemString = aclItemString.toLowerCase();\n\n  const parts = aclItemString.split(\":\");\n  if (parts.length < 1 || parts.length > 3) {\n    throw error;\n  }\n\n  if (parts.length === 3) {\n    if (parts[0] !== \"default\") {\n      throw error;\n    }\n  }\n\n  let defaultScope = false;\n  let index = 0;\n  if (parts[index] === \"default\") {\n    defaultScope = true;\n    index++;\n  }\n\n  const accessControlType = parts[index++];\n  if (\n    accessControlType !== \"user\" &&\n    accessControlType !== \"group\" &&\n    accessControlType !== \"mask\" &&\n    accessControlType !== \"other\"\n  ) {\n    throw error;\n  }\n\n  const entityId = parts[index++];\n\n  return {\n    defaultScope,\n    accessControlType,\n    entityId,\n  };\n}\n\nexport function toAcl(aclString?: string): PathAccessControlItem[] {\n  if (aclString === undefined || aclString === \"\" || aclString === null) {\n    return [];\n  }\n\n  const acls = [];\n  const aclParts = aclString.split(\",\");\n  for (const aclPart of aclParts) {\n    acls.push(toAccessControlItem(aclPart));\n  }\n\n  return acls;\n}\n\nexport function toRemoveAcl(aclString?: string): RemovePathAccessControlItem[] {\n  if (aclString === undefined || aclString === \"\" || aclString === null) {\n    return [];\n  }\n\n  const acls = [];\n  const aclParts = aclString.split(\",\");\n  for (const aclPart of aclParts) {\n    acls.push(toRemoveAccessControlItem(aclPart));\n  }\n\n  return acls;\n}\n\nexport function toAccessControlItemString(item: PathAccessControlItem): string {\n  const entityIdString = item.entityId !== undefined ? `:${item.entityId}` : \"\";\n  const permissionsString =\n    item.permissions !== undefined ? `:${toRolePermissionsString(item.permissions)}` : \"\";\n  return `${item.defaultScope ? \"default:\" : \"\"}${\n    item.accessControlType\n  }${entityIdString}${permissionsString}`;\n}\n\nexport function toAclString(acl: PathAccessControlItem[]): string {\n  return acl.map(toAccessControlItemString).join(\",\");\n}\n\nexport function toRolePermissionsString(p: RolePermissions, stickyBit: boolean = false): string {\n  return `${p.read ? \"r\" : \"-\"}${p.write ? \"w\" : \"-\"}${\n    stickyBit ? (p.execute ? \"t\" : \"T\") : p.execute ? \"x\" : \"-\"\n  }`;\n}\n\nexport function toPermissionsString(permissions: PathPermissions): string {\n  return `${toRolePermissionsString(permissions.owner)}${toRolePermissionsString(\n    permissions.group,\n  )}${toRolePermissionsString(permissions.other, permissions.stickyBit)}${\n    permissions.extendedAcls ? \"+\" : \"\"\n  }`;\n}\n\nexport function toAccessControlChangeFailureArray(\n  aclFailedEntries: AclFailedEntry[] = [],\n): AccessControlChangeError[] {\n  return aclFailedEntries.map((aclFailedEntry: AclFailedEntry) => {\n    return {\n      name: aclFailedEntry.name || \"\",\n      isDirectory: (aclFailedEntry.type || \"\").toLowerCase() === \"directory\",\n      message: aclFailedEntry.errorMessage || \"\",\n    };\n  });\n}\n\nexport function toBlobCpkInfo(input?: CpkInfo): BlobCpkInfo | undefined {\n  return input\n    ? {\n        encryptionKey: input.encryptionKey,\n        encryptionKeySha256: input.encryptionKeySha256,\n        encryptionAlgorithm: \"AES256\",\n      }\n    : undefined;\n}\n"]}